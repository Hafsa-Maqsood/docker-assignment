pipeline {
  agent any

  environment {
    // Optional: configure a registry or other environment variables here
    NODE_ENV = 'production'
  }

  stages {
    stage('Checkout') {
      steps {
        // Pull code from the configured branch in Jenkins
        checkout scm
      }
    }

    stage('Install Dependencies') {
      steps {
        echo 'Installing npm dependencies...'
        sh 'npm install'
      }
    }

    stage('Run Tests') {
      steps {
        echo 'Running unit tests...'
        // If you have test reports, generate JUnit XML for Jenkins
        sh 'npm test'
      }
      post {
        always {
          // Publish test results if your test runner outputs JUnit XML
          junit '**/test-results/*.xml'
        }
      }
    }

    stage('Build') {
      steps {
        echo 'Building the ToDo app...'
        sh 'npm run build'
      }
      post {
        success {
          // Archive build artifacts for later download
          archiveArtifacts artifacts: 'build/**', fingerprint: true
        }
      }
    }

    stage('Deploy') {
      steps {
        echo 'Deploying the ToDo app...'
        // Insert your actual deployment commands here, e.g.:
        // sh 'scp -r build/ user@server:/var/www/todo'
        // or Docker commands:
        // sh 'docker build -t myorg/todo:${BUILD_NUMBER} .'
        // sh 'docker push myorg/todo:${BUILD_NUMBER}'
      }
    }
  }

  post {
    always {
      echo 'Cleaning up workspace'
      cleanWs()
    }
    failure {
      echo 'Build failed!'
    }
    success {
      echo 'Build completed successfully.'
    }
  }
}
